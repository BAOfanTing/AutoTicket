å…è´£å£°æ˜ï¼šè¯¦è§MIT Licenseï¼Œæ­¤ä»“åº“ä»…ç”¨äºä¸ªäººå‚è€ƒå­¦ä¹ ï¼Œä½†å¦‚ä»–äººç”¨æœ¬ä»“åº“ä»£ç ç”¨äºå•†ä¸šç”¨é€”ï¼Œä¾µçŠ¯åˆ°æ­å·¥eå®¶ç­‰ï¼Œæœ¬äººä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚

# æ­å·¥eå®¶appåœ°é“åˆ¸

è¯·å¤§å®¶ä¸è¦å¤šæŠ¢,è‡ªå·±å¤Ÿç”¨äº†å°±è¡Œäº†

å¦‚æœ‰è¯¯è¿˜æœ›å¤§ä½¬æŒ‡å‡º,æ–‡ç« æä¾›æ€è·¯,å®Œæ•´ä»£ç è¯·æŸ¥çœ‹ä»“åº“

æœ¬æ¥æ¯å¤©éƒ½èƒ½æ‰‹åŠ¨æŠ¢åˆ°,ç°åœ¨è¿™appä»6000å¼ ç åˆ°1000å¼ ,è¿æŠ¢3å¤©éƒ½æ²¡æŠ¢ç€,ç—›å®šæ€ç—›å­¦ä¹ ä¸€ä¸‹æ€ä¹ˆä¸Šç§‘æŠ€

ä»£ç ä»“åº“:https://github.com/BAOfanTing/AutoTicket

# æ›´æ–°è®°å½•
9.9 æ‰“åŒ…ä¸ºexe,å¡«å…¥ä¿¡æ¯ç›´æ¥è¿è¡Œ

8.28 çœ‹äº†ä¸‹æŠ¢åˆ°ç¥¨çš„æ—¶é—´åŸºæœ¬éƒ½æ˜¯05ç§’,æ‰“ç®—ä¿®æ”¹è¯•è¯•

8.16,8.17,8.18,8.19éƒ½èƒ½æŠ¢åˆ°,ä¸å¤ªç¨³å®š

8.15 æ—©ä¸Š7ç‚¹,æŠ¢ç€ä¸€å¼ 4å¿«çš„ä¼˜æƒ åˆ¸,5ç‚¹æŠ¢ç€ä¸€å¼ 4å—çš„, æ€»ä½“æ²¡å•¥é—®é¢˜,æ—¶é—´ä¸Šå¤§å®¶å¯ä»¥è‡ªè¡Œè¯•

8.14 è§£å†³æ•°å­—ç­¾åé”™è¯¯é—®é¢˜,å›åº”å˜ä¸º,ç§¯åˆ†å…‘æ¢-æ´»åŠ¨è´­ä¹°å¤±è´¥. å“åº”æˆåŠŸå˜ä¸º æ‰‹æ…¢,ä¼˜æƒ åˆ¸è¢«æŠ¢å…‰

8.13 èƒ½å¤Ÿè§£å¯†å›åº”æ¶ˆæ¯,æ›´å¥½æ’æŸ¥,å‘ç°signæ„å»ºçš„æ¯”å®˜æ–¹çš„çŸ­å¾ˆå¤š,é—®é¢˜åº”è¯¥åœ¨è¿™

8.12ä¸­åˆ11.30æµ‹è¯•å¤±è´¥,æ„Ÿè§‰è¿˜æ˜¯å¾—æŠ“ä¸ªæŠ¢æˆåŠŸçš„åŒ…çœ‹çœ‹(mmd,æ‰‹æŠ¢éƒ½æŠ¢ä¸åˆ°)

8.8 å¼€å§‹å­¦ä¹ 

## Star History

[![Star History Chart](https://api.star-history.com/svg?repos=BAOfanTing/AutoTicket&type=Date)](https://www.star-history.com/#BAOfanTing/AutoTicket&Date)

# TODO
- [ ] æ‰“åŒ…ä¸ºä¸€ä¸ªå®‰å“app,ç›´æ¥è‡ªåŠ¨æŠ“å–ä¿¡æ¯ğŸš€

# å‚æ•°é…ç½®

`PUBLIC_KEY_PEM` å…¬é’¥,æŠ“åŒ…è·å–,åº”è¯¥å¤§å®¶éƒ½ä¸€æ ·

`SES_ID` =  æŠ“åŒ…å¾—åˆ°çš„id,ä¹Ÿå¯æ¨¡æ‹Ÿå™¨æœ¬åœ°æ–‡ä»¶æŸ¥çœ‹è·å–,é‡æ–°ç™»å½•åses_idä¼šå˜åŒ–

`LOGIN_NAME_PLAINTEXT`=æ¨¡æ‹Ÿå™¨æœ¬åœ°æ–‡ä»¶æŸ¥çœ‹è·å–

`USER_ID_PLAINTEXT` = æ¨¡æ‹Ÿå™¨æœ¬åœ°æ–‡ä»¶æŸ¥çœ‹è·å–

`exchange_id`  9æ˜¯2å—åœ°é“åˆ¸  10æ˜¯4å—åœ°é“åˆ¸   11æ˜¯6å—åœ°é“åˆ¸

`RUN_TIME` = datetime(2025, 8, 19, 17, 00, 1, 500000)   è¿è¡Œçš„æ—¶é—´   å»ºè®®åªä¿®æ”¹å°æ—¶å’Œåˆ†é’Ÿ

`RUN_COUNT` = 50        # è¿è¡Œæ¬¡æ•° å»ºè®®é»˜è®¤

# è¿è¡Œæµç¨‹

é…ç½®å¥½fiddlerä¸æ¨¡æ‹Ÿå™¨(æ¨¡æ‹Ÿå™¨æ‰“ä¸æ‰“å¼€éƒ½è¡Œ)---æ‰“å¼€fiddler----å¯åŠ¨ç¨‹åº  èƒ½å¤Ÿå¾—åˆ°æ‰‹æ…¢äº†,ä¼˜æƒ åˆ¸è¢«æŠ¢å®Œ è¯´æ˜æ­¥éª¤å¯¹äº†

# fiddleræŠ“å–é›·ç”µæ¨¡æ‹Ÿå™¨æ‰‹æœºçš„åŒ…

# 1. é…ç½®fiddler

## 1.1 å¯¼å‡ºCAè¯ä¹¦

HTTPS--è¿™ä¸ªå‡ ä¸ªå‹¾ä¸Š,ç„¶åActionsé€‰æ‹©Export to desktopæŠŠcaè¯ä¹¦å¯¼å‡ºåˆ°æ¡Œé¢

![image-20250808141430472](https://gitee.com/baofanting/image/raw/master/image/20250814091612868.png)

![image-20250808141607651](https://gitee.com/baofanting/image/raw/master/image/20250814091612869.png)

åŒå‡»å®‰è£…è¯ä¹¦---å½“å‰ç”¨æˆ·----å°†æ‰€æœ‰è¯ä¹¦æ”¾å…¥ä¸‹åˆ—å­˜å‚¨(å—ä¿¡ä»»çš„)--å®Œæˆ

<img src="https://gitee.com/baofanting/image/raw/master/image/20250814091612870.png" alt="image-20250808151548827" style="zoom:50%;" />

## 1.2 é…ç½®fiddlerå…è®¸è¿œç¨‹è¿æ¥

connections--å‹¾é€‰Allow remote computers to connect  å¼€å¯è¿œç¨‹è¿æ¥ç›‘æ§,ç«¯å£æ˜¯8888

![image-20250808142039727](https://gitee.com/baofanting/image/raw/master/image/20250814091612872.png)

# 2 æ¨¡æ‹Ÿå™¨å‚æ•°é…ç½®

ç”µè„‘æ‰“å¼€cmd,è¾“å…¥ `ipconfig`æŸ¥çœ‹è‡ªå·±çš„ipv4åœ°å€

![image-20250808142417511](https://gitee.com/baofanting/image/raw/master/image/20250814091612873.png)

æ‰“å¼€æ¨¡æ‹Ÿå™¨æµè§ˆå™¨è¾“å…¥ `http://192.168.1.168:8888`å¯ä»¥çœ‹åˆ°è¿™æ ·çš„ç•Œé¢,ç‚¹å‡»ä¸‹æ–¹ä¸‹è½½è¯ä¹¦

![image-20250808142643651](https://gitee.com/baofanting/image/raw/master/image/20250814091612874.png)

ç›´æ¥æµè§ˆå™¨ä¸‹è½½æ‰“å¼€å®‰è£…,è®¾ç½®åç§°ä¸ºfiddler.é€”ä¸­ä¼šè®©ä½ è®¾ç½®ä¸€ä¸ªé”å±å¯†ç 

![image-20250808143036870](https://gitee.com/baofanting/image/raw/master/image/20250814091612875.png)

è®¾ç½®è¿æ¥çš„wifiä»£ç†,ä¸»æœºåå°±æ˜¯ä½ çš„ipv4åœ°å€,ç«¯å£å·å°±æ˜¯8888

<img src="https://gitee.com/baofanting/image/raw/master/image/20250814091612876.png" alt="image-20250808143548184" style="zoom:50%;" />

ä¿å­˜åæˆ‘ä»¬æ‰“å¼€ä¸€äº›åº”ç”¨,åœ¨fiddlerä¸­å¯ä»¥çœ‹åˆ°æŠ“åŒ…ä¿¡æ¯,ld9boxå°±æ˜¯é›·ç”µæ¨¡æ‹Ÿå™¨9å‘å‡ºçš„http,è¿™ä¸ªhzghåº”è¯¥æ˜¯æˆ‘æ‰“å¼€çš„æ­å·¥eå®¶app

<img src="https://gitee.com/baofanting/image/raw/master/image/20250814091612877.png" alt="image-20250808151733261" style="zoom:50%;" />

èƒ½å¤ŸæŠ“åˆ°åŒ…äº†,ä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆå¼„ä¼˜æƒ åˆ¸

# 3.æŠ“åŒ…æŠ¢åˆ¸çš„æ¥å£

æ­¤æ—¶æˆ‘ç‚¹å‡»æŠ¢ä¼˜æƒ åˆ¸,å‘å‡ºçš„è¯·æ±‚æ˜¯è¿™ä¸ª

![image-20250808153445275](https://gitee.com/baofanting/image/raw/master/image/20250814091612878.png)

å³å‡»save---Selected sessions --save as text   æŠŠæ•´ä¸ªæ•°æ®åŒ…å¯¼å‡º

- `timestamp`: æ¯æ¬¡ç‚¹å‡»éƒ½ä¸åŒï¼Œä¸”æ˜¯ä¸€ä¸ª **æ¯«ç§’çº§æ—¶é—´æˆ³**ï¼ˆä¸è¿‡ä½ çš„æ—¶é—´æˆ³å€¼åœ¨ 1754... è¿™ä¸ªå¹´ä»½çº§åˆ«ï¼Œåº”è¯¥æ˜¯è¢«åŠ åç§»æˆ–åšäº†æ—¶é—´æ··æ·†å¤„ç†ï¼‰
- `login_name` / `user_id`: çœ‹èµ·æ¥æ˜¯ç›¸åŒå€¼ï¼Œä½†éƒ½æ˜¯ä¸€ä¸² **Base64 ç¼–ç åå†åŠ å¯†** çš„å¯†æ–‡
- `dec_key`: æ¯æ¬¡ä¸åŒï¼Œå¾ˆå¯èƒ½æ˜¯å‰ç«¯ç”¨æŸç§å…¬é’¥ç®—æ³•ç”Ÿæˆçš„ä¼šè¯å¯†é’¥
- `sign`: æ¯æ¬¡ä¸åŒï¼Œæ˜¯æ ¹æ® key åˆ—è¡¨é‡Œè¿™äº›å­—æ®µåšçš„æ•°å­—ç­¾å

# 5 è§£å¯†

ä¸‹è½½ `jadx`æ”¾å…¥appé€†å‘,æ ¹æ®ä¹‹å‰è¿›å…¥æŠ¢ç¥¨ç•Œé¢ä¼š404,æ¨æµ‹appæ˜¯ç›´æ¥æ‹‰äº†ä¸€ä¸ªç½‘é¡µæ¥å±•ç¤º,å¹¶ä¸”åœ¨é‡Œè¾¹æœç´¢OL41,dec_key éƒ½æ²¡æœ‰æ‰¾åˆ°,ä½†æ˜¯æœç´¢ `loadUrl`èƒ½å¤ŸæŸ¥è¯¢åˆ°ä¸€å †,ä¹Ÿæ›´åŠ è‚¯å®šäº†æˆ‘çš„æ¨æµ‹

<img src="https://gitee.com/baofanting/image/raw/master/image/20250814091612879.png" alt="image-20250808173742878" style="zoom:50%;" />

#### 5.1 å…ˆæ‰¾åˆ°å…¥å£ Activity

åœ¨æ¨¡æ‹Ÿå™¨é‡Œç‚¹è¿›**æŠ¢åˆ¸é¡µé¢**ï¼ŒåŒæ—¶æ‰“å¼€ `cmd`è¾“å…¥ `adb shell dumpsys activity activities | findstr mResumedActivity`,ç”¨ **adb** çœ‹å½“å‰ç•Œé¢æ‰€å±çš„ Activityï¼š

![image-20250811111736249](https://gitee.com/baofanting/image/raw/master/image/20250814091612880.png)

å¯ä»¥çœ‹åˆ° `com.zjte.hanggongefamily/.home.acitvity.CommonWebActivity t4`,`com.zjte.hanggongefamily` æ˜¯åŒ…å,`.home.acitvity.CommonWebActivity t4` æ˜¯ç±»å,æˆ‘ä»¬å°±éœ€è¦è¿™ä¸ªç±»å,è¿™è¯´æ˜æŠ¢åˆ¸é¡µé¢ç¡®å®æ˜¯ç”¨ **WebView æ‰“å¼€ç½‘é¡µ** çš„ï¼Œä¸æ˜¯åŸç”Ÿç•Œé¢ã€‚

æ‰“å¼€ `jadx`,è¿›å…¥è¿™ä¸ªè·¯å¾„ `com.zjte.hanggongefamily/home/acitvity/CommonWebActivity`,ä½†æ˜¯è¿™ä¸ªç±»ç¡®å®åªæ˜¯ä¸€ä¸ª **é€šç”¨ WebView å®¹å™¨**,å®ƒç”¨ `getIntent().getStringExtra("url")` æ‹¿åˆ°ä¸€ä¸ª URL,ç„¶åç›´æ¥ `webView.loadUrl(url)`,æ²¡æœ‰ä»»ä½•å’Œ `OL41`ã€`sign`ã€`dec_key` ç›¸å…³çš„åŠ å¯†é€»è¾‘,æ‰€ä»¥æŠ¢åˆ¸çš„è¯·æ±‚ä¸€å®šæ˜¯ **ç½‘é¡µé‡Œçš„ JavaScript å‘å‡ºå»çš„**ï¼Œè€Œä¸æ˜¯è¿™ä¸ª Java ç±»æœ¬åœ°æ„é€ çš„

![image-20250811114548709](https://gitee.com/baofanting/image/raw/master/image/20250814091612881.png)

æˆ‘ä»¬éœ€è¦æ‰¾åˆ° `new Intent(, CommonWebActivity.class)`,æ˜¯è°å¯åŠ¨äº† `CommonWebActivity`å¹¶ä¼ å…¥äº†url,ä½†æ˜¯æœç´¢å‡ºæ¥æœ‰å¥½å¤š

![image-20250811114849742](https://gitee.com/baofanting/image/raw/master/image/20250814091612882.png)

## 5.2 æ‰¾åˆ°.js

ç‚¹å‡»è¿›å…¥æŠ¢4å…ƒä¼˜æƒ åˆ¸çš„ç•Œé¢å’ŒåŠ è½½äº†è¿™å‡ ä¸ªjs,å°è¯•è·å–ä»–ä»¬äº§çœ‹,åœ¨fiddlerå³é”® â†’ Save â†’ Response â†’ Response Body,ä¸‹è½½jsæ–‡ä»¶

![image-20250811131546059](https://gitee.com/baofanting/image/raw/master/image/20250814091612883.png)

æ‰“å¼€å‘ç°æ˜¯ä¹±ç çš„,ç‚¹å‡»fiddler,ç‚¹å‡»è¿™é‡Œç¼–ç å,èƒ½å¤Ÿåœ¨è½¯ä»¶é‡ŒæŸ¥çœ‹,å†æ¬¡å¯¼å‡ºjs,èƒ½å¤ŸæŸ¥çœ‹åˆ°æ•°æ®

![image-20250811133013639](https://gitee.com/baofanting/image/raw/master/image/20250814091612884.png)

![image-20250811133207642](https://gitee.com/baofanting/image/raw/master/image/20250814091612885.png)

æ­¤æ—¶æ‰“å¼€æŸ¥æ‰¾,æœç´¢å…‘æ¢,å¯ä»¥çœ‹åˆ°æœ‰äº†,æˆ‘ä»¬åº”è¯¥æ˜¯æ‰¾åˆ°äº†æ­£ç¡®çš„jsæ–‡ä»¶,æ˜¯ `chunk-337319a5.alalb541.js`![image-20250811133732176](https://gitee.com/baofanting/image/raw/master/image/20250814091612886.png)

aiåˆ†æä¸€æ³¢

**OL41 æ¥å£è°ƒç”¨ä½ç½®**

- åœ¨æ¨¡å— `ec15` é‡Œï¼š

  ```
  jså¤åˆ¶ç¼–è¾‘function C(t = {}) {
      return Object(i["a"])({
          url: "/interf/front/OL/OL41",
          method: "post",
          data: t,
          handleCatch: !0
      });
  }
  ```

  ä¹Ÿå°±æ˜¯ `r["i"]`ã€`r["j"]`ã€`r["C"]` ç­‰å½¢å¼è°ƒç”¨æ—¶ï¼Œå®é™…ä¸Šä¼šèµ°åˆ°è¿™ä¸ª OL41 è¯·æ±‚ã€‚

**è°ƒç”¨ OL41 çš„ä¸šåŠ¡é€»è¾‘**

- åœ¨ç»„ä»¶çš„ `methods.toGetOL()` é‡Œï¼š

  ```
  js
  
  å¤åˆ¶ç¼–è¾‘
  Object(r["j"])({ exchange_id: this.id })
  ```

  è¿™é‡Œçš„ `r["j"]` å°±æ˜¯ `/OL/OL42`ï¼Œä½†è·å–æ´»åŠ¨ä¿¡æ¯ `fetchActivityOLInfo()` è°ƒçš„æ˜¯ `r["i"]`ï¼ˆ`OL41`ï¼‰ï¼Œæ‰€ä»¥ OL41 ä¸»è¦æ˜¯è·å–è¯¦æƒ…ï¼ŒOL42 æ‰æ˜¯æäº¤å…‘æ¢ã€‚

**æ²¡æœ‰ sign/dec_key ç”Ÿæˆé€»è¾‘**

- åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œæ²¡æœ‰ `CryptoJS`ã€`sign`ã€`dec_key` çš„ç”Ÿæˆé€»è¾‘ï¼Œè¯´æ˜è¿™äº›åŠ å¯†å‚æ•°æ˜¯åœ¨ **`b775` æ¨¡å—** é‡Œç»Ÿä¸€å°è£…çš„ï¼ˆ`Object(i["a"])` å°±æ˜¯ä» b775 å¼•æ¥çš„ï¼‰ã€‚
- ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¾—å» `b775` é‡Œæ‰¾å…¨å±€è¯·æ±‚å°è£…å‡½æ•°ï¼Œé‚£é‡Œä¼šåœ¨ `data` ä¹‹å¤–é¢å¤–åŠ ä¸ŠåŠ å¯†å­—æ®µã€‚

**è¿™ä¸ª JS æ˜¯ H5 é¡µé¢**

- è¿™ä¸ªç»„ä»¶æ˜¯ Vue å•æ–‡ä»¶ç¼–è¯‘å‡ºæ¥çš„ï¼Œè¿è¡Œåœ¨ WebView é‡Œï¼ˆ`CommonWebActivity` æ‰“å¼€äº†è¿™ä¸ª H5ï¼‰ã€‚
- æ‰€ä»¥ OL41ã€OL42 è¯·æ±‚å’ŒåŠ å¯†é€»è¾‘å…¨éƒ½å‘ç”Ÿåœ¨ H5 JS é‡Œï¼Œä¸åœ¨åŸç”Ÿ App ä»£ç ä¸­ã€‚

é‡ç‚¹æ˜¯æ‰¾åˆ°è¿™ä¸ª `b775`,åŠ è½½æŠ¢åˆ¸ç•Œé¢çš„æ—¶å€™æ²¡æœ‰è¿™ä¸ªb775,é‚£åªèƒ½åœ¨å¼€å¯ç¨‹åºçš„æ—¶å€™æœ‰äº†å§,æˆ‘ä»¬åœ¨å‰è¾¹æœç´¢,ä¸€ç›´æˆåŠŸæ‰¾åˆ°ä¸¤ä¸ªä¸ªæ–‡ä»¶åŒ…å« `b775`.

![image-20250811135619722](https://gitee.com/baofanting/image/raw/master/image/20250814091612887.png)

æœ€ç»ˆåœ¨ `app-ea1f58e8.825614f8.js`è¿™é‡Œæ‰¾åˆ°äº† `b775`çš„å‡½æ•°å®šä¹‰,å¹¶ä¸”åœ¨å‡½æ•°é‡Œæœ‰ç›¸å…³çš„åŠ å¯†ä¿¡æ¯

![image-20250811140759076](https://gitee.com/baofanting/image/raw/master/image/20250814091612888.png)

#### 1. åŠ å¯†ç›¸å…³å·¥å…·ï¼ˆ`A` å¯¹è±¡ï¼‰

- `encrypt(c)`ï¼šç”¨ SM2 å…¬é’¥åŠ å¯†æ•°æ® `c`ã€‚
- `decrypt(c)`ï¼šç”¨ SM2 ç§é’¥è§£å¯†æ•°æ® `c`ã€‚
- `getSign(c)`ï¼šå¯¹æ•°æ® `c` è¿›è¡Œ SM2 ç­¾åï¼ˆhash å’Œ DER æ ¼å¼ï¼‰ã€‚
- `verifySign(c, e)`ï¼šéªŒè¯ SM2 ç­¾åã€‚

#### 2. é‡è¦å¯†é’¥å’Œå‚æ•°

- `v`, `w`ï¼šSM2 çš„ç§é’¥å’Œå…¬é’¥ï¼ˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰ã€‚
- `publicKey`, `privateKey`ï¼šRSA å…¬ç§é’¥ï¼Œåšç­¾åéªŒç­¾ç”¨ã€‚
- `encryptKeys`ï¼šéœ€è¦å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œå¯¹ç§°åŠ å¯†çš„å­—æ®µåˆ—è¡¨ã€‚
- `noSignKeys`ï¼šä¸å‚ä¸ç­¾åçš„å­—æ®µã€‚
- `signkey`, `signNewKey`ï¼šç”¨äºç­¾åçš„å¯†é’¥ã€‚

#### 3. å¯¹ç§°åŠ å¯†å‡½æ•°

- `O(c, e)`ï¼šä½¿ç”¨ 3DES ECB æ¨¡å¼å¯¹å­—ç¬¦ä¸² `e` ç”¨å¯†é’¥ `c` è¿›è¡ŒåŠ å¯†ï¼Œè¿”å›å¯†æ–‡å­—ç¬¦ä¸²ã€‚
- `j(c, e, n)`ï¼š3DES CBC æ¨¡å¼è§£å¯†å‡½æ•°ï¼Œç”¨ `c` åš keyï¼Œ`e` ä½œä¸º iv è§£å¯†å¯†æ–‡ `n`ã€‚

#### 4. ç­¾åå‡½æ•° `B(c)`

- ä½¿ç”¨ RSA ç§é’¥å¯¹å­—ç¬¦ä¸² `c` è¿›è¡Œ SHA256withRSA ç­¾åï¼Œè¾“å‡º base64 æ ¼å¼çš„ç­¾åã€‚

#### 5. éšæœºå­—ç¬¦ä¸²ç”Ÿæˆ `I(c, e, n)`

- ç”Ÿæˆé•¿åº¦éšæœºï¼ˆæˆ–å›ºå®šé•¿åº¦ï¼‰çš„å­—ç¬¦ä¸²ï¼ŒåŒ…å«æ•°å­—å’Œå¤§å°å†™å­—æ¯ã€‚

#### 6. åŠ å¯†å’Œç­¾åæµç¨‹ `_encryptAndSign`

- åˆå¹¶å…¬å…±å‚æ•°å’Œä¸šåŠ¡å‚æ•°ã€‚
- æ ¹æ®ç‰ˆæœ¬å’Œæ¸ é“é€‰æ‹© RSA å…¬é’¥ã€‚
- ç”Ÿæˆéšæœºå¯†é’¥ `m`ï¼Œç”¨ RSA å…¬é’¥åŠ å¯†è¯¥å¯†é’¥ï¼Œå­˜ä¸º `dec_key`ã€‚
- å¯¹è¯·æ±‚ä¸­æŒ‡å®šå­—æ®µï¼ˆ`encryptKeys` æˆ– `JSONServletEncryptKeys`ï¼‰ç”¨ 3DES å¯¹ç§°åŠ å¯†ï¼ˆå¯†é’¥ä¸º `m`ï¼‰ã€‚
- ç”Ÿæˆç­¾åï¼šæ‹¼æ¥å‚æ•°å€¼ï¼ˆé™¤ä¸ç­¾åå­—æ®µï¼‰è¿›è¡Œç­¾åã€‚
- è¿”å›å¤„ç†åçš„æ•°æ®å¯¹è±¡ã€‚

#### 7. SM2 åŠ å¯†å’Œç­¾åæµç¨‹ `_encryptAndSign_SM`

- é€šè¿‡ SM2 å¯¹éƒ¨åˆ†å‚æ•°å’Œè¯·æ±‚å¤´å­—æ®µåŠ å¯†ã€‚
- è¿”å›åŒ…å«è¯·æ±‚å¤´ã€è¯·æ±‚ä½“å’Œç­¾åçš„å¯¹è±¡ã€‚

#### 8. è§£å¯† `_decrypt`

- ç”¨ RSA ç§é’¥è§£å¯†æ•°æ®ã€‚
- è¿›ä¸€æ­¥ç”¨ 3DES CBC è§£å¯†å®é™…æ•°æ®ã€‚
- è¿”å›è§£å¯†åçš„ JSON å¯¹è±¡ã€‚

## 5.3 æ­å»ºè¯·æ±‚

è®©aiä¿®æ”¹ä»£ç ,`SES_ID`å°±æ˜¯ä¹‹å‰æŠ“åŒ…çš„ä¸€ç›´ä¸å˜çš„,`login_name`å’Œ `user_id`éœ€è¦è·å–åˆ°æ˜æ–‡

```python
import requests
import time
import random
import string
import base64
import hashlib
from Crypto.Cipher import DES3, PKCS1_v1_5
from Crypto.PublicKey import RSA

# ================= é…ç½®åŒºåŸŸ =================
PUBLIC_KEY_PEM = """-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCVXsxrrMcxNwFNYt0wMTdqc5WMa4gr7nMbWbcQCpJ2XNBMTQetknYNzCr8MMRdHBKFKjdCJE40u6UDBXQx13z7OSKyvQBwtLj5n8eIQXRtpMIjvqfR1xRuNBi5147ZXJDbKxWGRm0kjLN5UuqnDe6zu8v6MKU7KNDzHUrWqsj2LwIDAQAB
-----END PUBLIC KEY-----"""

SIGN_KEY = "qwerqaz.-*"   # b775 é‡Œç”¨çš„å›ºå®š signkey
ENCRYPT_KEYS = ["login_name", "user_id"]  # éœ€è¦ 3DES åŠ å¯†çš„å­—æ®µ
SES_ID = "ä½ çš„sesid"
LOGIN_NAME_PLAINTEXT = "ä½ çš„login_nameæ˜æ–‡"
USER_ID_PLAINTEXT = "ä½ çš„user_idæ˜æ–‡"

URL = "https://app.hzgh.org.cn/unionApp/interf/front/OL/OL41"
# ============================================


def random_str(length):
    """ç”Ÿæˆéšæœºå­—ç¬¦ä¸²"""
    chars = string.ascii_letters + string.digits
    return ''.join(random.choice(chars) for _ in range(length))


def rsa_encrypt(pub_key_pem, plaintext):
    """RSA å…¬é’¥åŠ å¯†"""
    rsakey = RSA.importKey(pub_key_pem)
    cipher = PKCS1_v1_5.new(rsakey)
    return base64.b64encode(cipher.encrypt(plaintext.encode())).decode()


def triple_des_encrypt(key, plaintext):
    """3DES ECB PKCS7 åŠ å¯†"""
    # 3DES è¦æ±‚ key é•¿åº¦æ˜¯ 24 å­—èŠ‚
    key_bytes = key.encode()
    cipher = DES3.new(key_bytes, DES3.MODE_ECB)
    pad_len = 8 - len(plaintext) % 8
    padded = plaintext + chr(pad_len) * pad_len
    return base64.b64encode(cipher.encrypt(padded.encode())).decode()


def build_payload():
    # 1. ç”Ÿæˆéšæœº 24 ä½ m
    m = random_str(24)

    # 2. RSA åŠ å¯†å¾—åˆ° dec_key
    dec_key = rsa_encrypt(PUBLIC_KEY_PEM, m)

    # 3. æ„å»ºæ•°æ®å­—å…¸
    data = {
        "channel": "02",
        "app_ver_no": "3.1.4",
        "timestamp": int(time.time() * 1000),
        "login_name": LOGIN_NAME_PLAINTEXT,
        "user_id": USER_ID_PLAINTEXT,
        "ses_id": SES_ID,
        "exchange_id": "10",
        "dec_key": dec_key
    }

    # 4. å¯¹ encryptKeys åˆ—è¡¨å†…çš„å­—æ®µç”¨ 3DES åŠ å¯†
    for k in ENCRYPT_KEYS:
        if data.get(k):
            data[k] = triple_des_encrypt(m, data[k])

    # 5. ç”Ÿæˆ key å­—æ®µ
    data["key"] = ",".join(data.keys())

    # 6. ç”Ÿæˆ sign
    sign_str = "".join(str(data[k]) for k in data if k != "sign") + SIGN_KEY
    md5_val = hashlib.md5(sign_str.encode()).hexdigest().upper()
    sha256_val = hashlib.sha256(md5_val.encode()).hexdigest().upper()
    data["sign"] = sha256_val

    return data


def main():
    headers = {
        "Host": "app.hzgh.org.cn",
        "Connection": "keep-alive",
        "Accept": "application/json, text/plain, */*",
        "User-Agent": "Mozilla/5.0 (Linux; Android 9; SKW-A0 Build/PQ3A.190705.08061357; wv) "
                      "AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/91.0.4472.114 "
                      "Safari/537.36;unionApp;HZGH",
        "Content-Type": "application/json;charset=UTF-8",
        "Origin": "https://app.hzgh.org.cn:8123",
        "X-Requested-With": "com.zjte.hanggongefamily",
        "Referer": "https://app.hzgh.org.cn:8123/",
        "Accept-Encoding": "gzip, deflate",
        "Accept-Language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"
    }

    payload = build_payload()
    print("è¯·æ±‚æ•°æ®:", payload)

    resp = requests.post(URL, headers=headers, json=payload, verify=False)
    print("çŠ¶æ€ç :", resp.status_code)
    print("å“åº”:", resp.text)


if __name__ == "__main__":
    main()

```

## 5.4 `login_name`å’Œ `user_id`æ˜æ–‡è·å–

ç›®å‰è¿˜æ²¡æœ‰æ‰¾åˆ°,ç›´æ¥è¾“æˆ‘çš„**æ‰‹æœºå·**äº†,è¿è¡Œç¨‹åºæŠ¥é”™,å‘ç°Python ç›´æ¥è¯·æ±‚ç›®æ ‡ HTTPS æ—¶ TLS æ¡æ‰‹å¤±è´¥,äºæ˜¯é€šè¿‡Fiddleråœ¨æ‰‹æœºappä¸Šå‘èµ·è¯·æ±‚

```pyhton
#è®©pythoné€šè¿‡fiddlerèµ°æ‰‹æœºçš„é€šé“å‘èµ·è¯·æ±‚
    proxies = {
        "http": "http://127.0.0.1:8888",
        "https": "http://127.0.0.1:8888"
    }
  
    resp = requests.post(URL, headers=headers, json=payload, verify=False, proxies=proxies)
```

ç›®å‰gptç»™å‡ºçš„æ–¹æ³•æ˜¯åœ¨ä½¿ç”¨ `root`æˆ–è€… `VirtualXposed`,æŸ¥çœ‹æœ¬åœ°æ•°æ®åŒ…**LocalStorage** æ–‡ä»¶,å¤åˆ¶åˆ°ç”µè„‘å†ç”¨æ•°æ®åº“æ‰“å¼€æœç´¢å…³é”®å­—.

æ‰“å¼€é›·ç”µæ¨¡æ‹Ÿå™¨è®¾ç½®--å…¶ä»–è®¾ç½®--å¼€å¯rootæƒé™,ä¸‹è½½ `mtç®¡ç†å™¨`æ‰“å¼€è·¯å¾„ `/data/data/com.zjte.hanggongefamily/app_webview/Default/Local Storage/leveldb/`èƒ½å¤Ÿçœ‹åˆ°æœ‰ä¸ªlogæ–‡ä»¶,ä»–å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„

![image-20250813092124912](https://gitee.com/baofanting/image/raw/master/image/20250814091612889.png)

æ‰“å¼€æœç´¢ `login_name`å‘ç°ç¡®å®å­˜åœ¨,ä½†æ„Ÿè§‰åƒæ˜¯åŠ å¯†è¿‡çš„,ä¹Ÿä¸ç®—æ˜æ–‡,åŒæ—¶ä¹Ÿèƒ½çœ‹åˆ°æœ‰å¾ˆå¤šçš„ `ses_id`å¯¹åº”ä¸åŒçš„å¯¹è¯,æˆ‘æ¸…æ¥šæ•°æ®é‡æ–°ç™»å½•äº†ä¸€é,è¿™ä¸ª `login_name`æ²¡æœ‰æ”¹å˜,åŸºæœ¬å¯ä»¥ç¡®å®šè¿™å°±æ˜¯äº†

![image-20250813093112715](https://gitee.com/baofanting/image/raw/master/image/20250814091612890.png)

æŠŠè¿™ä¸ªæ”¾å…¥ç¨‹åº,å¾—åˆ°çš„è¯·æ±‚ç»“æœçš„login_nameé•¿åº¦ä¸æŠ“åŒ…çš„å¾—åˆ°çš„é•¿åº¦ç±»ä¼¼

![image-20250813094250321](https://gitee.com/baofanting/image/raw/master/image/20250814091612891.png)

æŠŠdbæ–‡ä»¶æ‰“å¼€,ä¹Ÿèƒ½å‘ç°,è¿™ä¸ªå°±æ˜¯

![image-20250813141225770](https://gitee.com/baofanting/image/raw/master/image/20250814091612892.png)

## 5.5 è¿è¡Œç¨‹åº

æˆåŠŸè¿è¡Œäº†,è€Œä¸”å¯ä»¥çœ‹åˆ°æ”¶åˆ°çš„å›å¤å’Œä¹‹å‰,ç›´æ¥æ‹¿ç‚¹å‡»æŒ‰é’®æŠ“åŒ…å‘é€çš„è¯·æ±‚çš„å›åº”å·®ä¸å¤š,å°±ç­‰åˆ°ç‚¹æµ‹è¯•äº†

![image-20250811174856064](https://gitee.com/baofanting/image/raw/master/image/20250814091612893.png)

# 6 è§£å¯†å›åº”

åœ¨æˆ‘ä»¬ç‚¹å‡»å‘é€ä¼šä¼šç»™ä¸€ä¸ªbase64çš„å›åº”,æŠŠä»–è¿›è¡Œè§£å¯†,æ¥çœ‹æˆ‘ä»¬çš„åŠ å¯†å¯¹ä¸å¯¹

```python
import base64
from Crypto.Cipher import PKCS1_v1_5, DES3
from Crypto.PublicKey import RSA
import json

PRIVATE_KEY_PEM = """-----BEGIN RSA PRIVATE KEY-----
MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAIOBMtf2AIYQlrNy
/lVPHx4R/LKI+Vtk3bKmzID8vdVnh/4WA3lczqfejM10Xfy3sNe4l5EeQTvnDgUH
bIFK8FyJRpvypAmS9oyW6uwGTjZEu5Y6hsSxiGAOG5ZOlH8vOSfuaAkZ+iUlqifP
E3ZOmHkqGzmukg4wCRaPLx5ioq8zAgMBAAECgYAgLOVmx677HmXxBCrMbq57agU9
HZx9SyGfS4Zv7Ob5pvo0Jei1sgpyMlabEmTIp50iOu0CubdWU8MvYdCfldlXQLW7
cjk8N1NyGQLFd2fJ03a7gGWnwwEdPoNTpSHnB+mDL9l7MVjion5fLojzq9Pz1gMK
L01I2TfZBDL4m6EbgQJBAMfgrMKtj7f40GA3qp/y/9/eBCAu8PbtFmtATLMQRf4t
Ghjvn349x1b6FZj8RiaRBSrq0Owjrdo5TUxgfS7dz3MCQQCobdWk2SQhRlqEHfFE
ro/8ab6gn3GhBDzzKvNjhKr2MO6JWqs+Vr+/P9uYpA+G+rv74uVIGWhjuNtI5+/6
9DFBAkAJOQS/tuJ6yrBSwD7PQpcr7UKjeYcE3cu7ByyC1q1kHRCnNedWG+Omz8NP
W9Sg0vA6GrupKbxL5Xj7nTgpgXKhAkBIVlvioAvfaqrngUClAd//RZ9EtxYDVKGk
wnaj8E/Iyr04KsPPU0ypJBD5XsT4cOmZxho5PAhUhAlSJ6MvAf/BAkA64ieVhtQA
1KV0pSSEJMnbPlZe+yBYGTWLMaG2zL0kKEhIs2fIHbVhLFQ8TkO5oH+mhxuuXI5+
nVU2G0dqUl6D
-----END RSA PRIVATE KEY-----"""

DES_IV = b"12345678"

# ================== è§£å¯†å‡½æ•° ==================
def pkcs7_unpad(data):
    pad_len = data[-1]
    return data[:-pad_len]

def decrypt_data2(data2):
    # 1. æå–å‰ 172 å­—èŠ‚ï¼ˆBase64è§£ç å‰æ˜¯å­—ç¬¦ä¸²é•¿åº¦172ï¼Œè§£ç åæ˜¯RSAå—ï¼‰
    rsa_enc = data2[:172]
    des_enc = data2[172:]

    # Base64 decode
    rsa_enc_bytes = base64.b64decode(rsa_enc)
    des_enc_bytes = base64.b64decode(des_enc)

    # 2. RSA ç§é’¥è§£å¯†ï¼Œå¾—åˆ° a
    rsakey = RSA.importKey(PRIVATE_KEY_PEM)
    cipher_rsa = PKCS1_v1_5.new(rsakey)
    a_bytes = cipher_rsa.decrypt(rsa_enc_bytes, None)
    a = a_bytes.decode()

    # 3. æ„é€  3DES key å’Œ iv
    key = ("HTt0Hzsu" + a).encode()
    iv = a[:8].encode()

    # 4. 3DES CBC PKCS7 è§£å¯†
    cipher_des3 = DES3.new(key, DES3.MODE_CBC, iv)
    decrypted = cipher_des3.decrypt(des_enc_bytes)
    decrypted = pkcs7_unpad(decrypted)

    # 5. è½¬æˆ JSON
    return decrypted.decode()

# ç¤ºä¾‹
data2_str = "Gx6vn2AcOSx0OgNWgVBnF6pE2WPUdl4PBl5BfT/Lv5tq3Yf7MsDMXGlvHwySfIvMnFMl6dwvtyjyAmuaQbqo+yB3lAgJ7sQb1kkhmpNZXrWGn31b1iYxqoZyRIOrGMDAoK5CNUjgF/VTaPxY9a5ypNUSWNVWUg7GtzAa+O7FHa4=xpg4u/l6MffuKk8aHF8fv90LdtzYt/oaqQon2qekZfqCmKpuJkQt/eyhO5g0OPID8pphMpu+qhDWGicQdkh5q3foqwrh3IgRy5kH1mulC7s="
print(decrypt_data2(data2_str))
```

å¯ä»¥çœ‹åˆ°è¿è¡Œå,ä»–æˆåŠŸæ‰“å°äº†æ¶ˆæ¯,

![image-20250813155139721](https://gitee.com/baofanting/image/raw/master/image/20250814091612894.png)

æˆ‘ä»¬å†æ¬¡è¿è¡Œä¹‹å‰çš„ç¨‹åº,ä»–çš„å›åº”æ˜¯æ•°å­—ç­¾åé”™è¯¯,å› æ­¤åªè¦æ˜¾ç¤ºçš„æ˜¯ä¼˜æƒ åˆ¸è¢«æŠ¢å…‰äº†,å°±è¯´æ˜æˆ‘ä»¬çš„ä»£ç æ­£ç¡®äº†

![image-20250813160803490](https://gitee.com/baofanting/image/raw/master/image/20250814091612895.png)

## 6.1 å›åº”æ˜¾ç¤º ç§¯åˆ†æŠ¢è´­å¤±è´¥

ä¹‹å‰çš„åŠ å¯†è§„åˆ™æœ‰ç‚¹é—®é¢˜,å¯¼è‡´signä¸æ˜¯172çš„å­—ç¬¦åºŠ,ä¿®æ”¹åå¯ä»¥çœ‹åˆ°æ•°å­—ç­¾åçš„é”™è¯¯å·²ç»è¢«è§£å†³äº†,ç°åœ¨æ˜¾ç¤ºçš„æ˜¯ `ç§¯åˆ†å…‘æ¢-æ´»åŠ¨è´­ä¹°å¤±è´¥`,ä½†æ˜¯æˆ‘è‡ªå·±æ‰‹åŠ¨ç‚¹å‡»æ˜¾ç¤ºçš„æ˜¯ä¼˜æƒ åˆ¸è¢«æŠ¢å…‰äº†,ä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨å•¥çš„éƒ½å·²ç»æ‰“é€šäº†,åŠ å¯†ç»“æœä¹Ÿå¯¹,ç„¶åses_id,login_name,user_id,ä¹Ÿæ˜¯å¯¹çš„,éš¾é“æ˜¯å…¬é’¥?

![image-20250814102114944](https://gitee.com/baofanting/image/raw/master/image/20250814102259932.png)

åˆå†ä¸€æ¬¡ä¼šçœ‹b775å‡½æ•°,é€šé“æ˜¯02,éš¾ä¸æˆå…¬é’¥,å¾—ä½¿ç”¨è¿™ä¸ª![image-20250814132107304](https://gitee.com/baofanting/image/raw/master/image/20250814132820859.png)

æ›¿æ¢åè¿è¡Œ,æœç„¶æˆåŠŸäº†,æˆåŠŸæ˜¾ç¤ºäº† `æ‰‹æ…¢,ä¼˜æƒ åˆ¸è¢«æŠ¢å…‰`å’Œç‚¹å‡»çš„æ•ˆæœä¸€è‡´

![image-20250814132451293](https://gitee.com/baofanting/image/raw/master/image/20250814132810495.png)

# 7 æŠ¢ç¥¨å®æˆ˜

è¿™ç½‘è¿˜æ˜¯å¾ˆå¡,5ç‚¹å‡†æ—¶æŠ¢æ˜¾ç¤ºç«çˆ†,æˆ‘å‘ç°æˆ‘çš„ç§¯åˆ†å°‘äº†5ä¸ª,ä½†æ˜¯æ²¡æœ‰ç¥¨ç»äº†,ç„¶åæµè§ˆäº†ä¸€ä¸ªæ–°é—»ç§¯åˆ†åˆåŠ å›æ¥äº†

![image-20250814170416147](https://gitee.com/baofanting/image/raw/master/image/20250814171002794.png)

8.15 æ—©ä¸Šä¸ƒç‚¹,ç»ˆäºæŠ¢åˆ°ä¸€å¼ ,å®šæ—¶10æ¬¡,å¤§å®¶éƒ½è¿™ä¹ˆå¼º,æˆ‘è¿™ç§‘æŠ€éƒ½æ‰åªæŠ¢åˆ°ä¸€å¼ 

<img src="https://gitee.com/baofanting/image/raw/master/image/20250815090042044.png" alt="image-20250815085626063"  />

<img src="https://gitee.com/baofanting/image/raw/master/image/20250815090013077.png" alt="image-20250815090000631"  />

# 8 ä¼˜åŒ–

æ—¶é—´ç²¾ç¡®åˆ°æ¯«ç§’çº§,ä½¿ç”¨çº¿ç¨‹åŒæ—¶å‘é€è¯·æ±‚

```python
def job():
    threads = []
    for i in range(RUN_COUNT):
        print(f"å‡†å¤‡å¯åŠ¨ç¬¬{i+1}ä¸ªçº¿ç¨‹ï¼Œæ—¶é—´ï¼š{datetime.now()}")
        t = threading.Thread(target=run_exchange, name=f"Thread-{i+1}")
        t.start()
        threads.append(t)
```

![image-20250815103054139](https://gitee.com/baofanting/image/raw/master/image/20250815103228415.png)

# æ›´æ–°æˆ˜ç»©

![image-20250819143149517](./image/image-20250819143149517.png)
